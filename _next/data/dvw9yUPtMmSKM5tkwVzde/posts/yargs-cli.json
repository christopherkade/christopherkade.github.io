{"pageProps":{"frontmatter":{"title":"Building a CLI with Yargs","description":"YAAARG(S) MATEY!","date":"2019-02-07","slug":"/posts/yargs-cli","isPublished":true},"content":"\n[Yargs](http://yargs.js.org/) is a great library to build command line apps, simply put, it will make the process of creating an application that runs in the console a breeze. What could make it even better? It's PIRATE themed (it's called YARgs you guys), making it officially the best tool ever.\n\nYou may know other CLIs such as [vue-cli](https://cli.vuejs.org/) to easily set up a Vue.js project or [create-react-app](https://facebook.github.io/create-react-app/), so the concept should be familiar to most of you.\n\nIn today's article we'll be creating a basic CLI from start to finish covering the following points:\n\n- [Project set up](#setup)\n- [Creating a basic CLI](#cli)\n- [Deploying our CLI to NPM](#deploy)\n\n<br><br>\n\n## <a name=\"setup\"></a> Project set up\n\nSetting up the project is very easy, start by doing the following:\n\n```bash\nmkdir yargs-project\ncd yargs-project\nnpm init -y\n```\n\nWe now have created our project's folder and initiated the `package.json` file that contains its meta data.\n\nHere's the file that was created:\n\n`package.json`:\n\n```json\n{\n  \"name\": \"yargs-example\",\n  \"version\": \"1.0.0\",\n  \"description\": \"\",\n  \"main\": \"index.js\",\n  \"scripts\": {\n    \"test\": \"echo \\\"Error: no test specified\\\"\n      && exit 1\"\n  },\n  \"keywords\": [],\n  \"author\": \"\",\n  \"license\": \"ISC\"\n}\n```\n\nWe need to do a few adjustments to this file since we're creating a CLI. It should now look like this:\n\n```json\n{\n  \"name\": \"yargs-example\",\n  \"version\": \"1.0.0\",\n  \"description\": \"A simple Yargs CLI\",\n  \"bin\": {\n    \"yargs-example\": \"./yargs-example.js\"\n  },\n  \"keywords\": [\"cli\"],\n  \"preferGlobal\": true,\n  \"author\": \"Christopher Kade\",\n  \"license\": \"ISC\"\n}\n```\n\nHere are the important changes to note:\n\n- We've added a `bin` value, which maps the entry file we'll create later to its executable name (you can set it to whatever you'd like)\n- We've set `preferGlobal` to true, meaning that our package would prefer to be installed globally (via `npm install -g` for example)\n\nOther tweaks include changing the `description`, removing usuned `scripts`, adding an `author` name etc.\n\nBefore we can start coding our CLI, we need to install `yargs`, do it like so:  \n`npm install yargs`\n\nLet's get to it.\n\n<br><br>\n\n## <a name=\"cli\"></a> Creating a basic CLI\n\nYargs makes it very easy to parse command line parameters, many example projects can be found [here](https://github.com/yargs/yargs/blob/master/docs/examples.md).\n\nWe'll create a basic CLI that takes in a file as parameter and counts the number of lines it has.\n\nTo do so, start by creating our main script file.  \n`touch yargs-example.js`\n\nAnd fill it with the following:\n\n```js\n#!/usr/bin/env node\nconst argv = require(\"yargs\")\n  .usage(\"Usage: $0 <command> [options]\")\n  .help(\"h\")\n  .alias(\"h\", \"help\").argv;\n```\n\nLet's cover everything line by line:\n\n1 - `#!/usr/bin/env node` is an instance of a shebang line that tells our system what interpreter to use to execute that file.\n\n2 - `const argv = require(\"yargs\")` imports the `yargs` package.\n\n3 - `.usage('Usage: $0 <command> [options]')` sets the usage information of your CLI that will be displayed when the `--help` command is called.\n\n4 - `.help('h')` binds the help command to the option `h`.\n\n5 - `.alias('h', 'help')` creates an alias for the option `-h`, namely `--help`.\n\nAs you can see, this first step is extremely simple, and `yargs` syntax is intuitive.\n\n<br>\n\nNext we'll add the `count` command.\n\nJust add the following lines to your already existing CLI:\n\n```js\n.command(\"count\", \"Count the lines in a file\")\n.example(\"$0 count -f foo.js\",\n  \"count the lines in the given file\")\n```\n\nOnce again, let's review them line by line.\n\n1 - `.command(\"count\", \"Count the lines in a file\")` creates a new command with the name `count` and sets a description.\n\n2 - `.example(\"$0 count -f foo.js\", \"count the lines in the given file\")` creates an example with a description, it will be displayed when the user calls the `--help` option or when they mess up the command.\n\n<br>\n\nThat's all great, but right now running `node yargs-example.js count` doesn't do much, next up we'll require a file name and finish the CLI by counting and displaying its number of lines.\n\nTo do so, add the following:\n\n```js\n.alias(\"f\", \"file\")\n.nargs(\"f\", 1)\n.describe(\"f\", \"Load a file\")\n.demandOption([\"f\"])\n```\n\nYour file should end up looking like this:\n\n```js\n#!/usr/bin/env node\nconst argv = require(\"yargs\")\n  .usage(\"Usage: $0 <command> [options]\")\n  .command(\"count\", \"Count the lines in a file\")\n  .example(\"$0 count -f foo.js\", \"count the lines in the given file\")\n  .alias(\"f\", \"file\")\n  .nargs(\"f\", 1)\n  .describe(\"f\", \"Load a file\")\n  .demandOption([\"f\"])\n  .help(\"h\")\n  .alias(\"h\", \"help\").argv;\n```\n\n1 - `.alias(\"f\", \"file\")` creates the alias `--file` for the `-f` option.\n\n2 - `.nargs(\"f\", 1)` sets the requirement of one argument for that option (the file name), otherwise display the `--help` menu.\n\n3 - `.describe(\"f\", \"Load a file\")` adds a description for the option.\n\n4 - `.demandOption([\"f\"])` since we'll need a file name, we're demanding the option `-f`.\n\n<br>\n\nFinally, let's add the program's logic like so:\n\n```js\nconst fs = require(\"fs\");\n\n// Create stream with the file\nconst s = fs.createReadStream(argv.file);\n\nvar lines = 0;\ns.on(\"data\", (buf) => {\n  // Get the number of lines\n  lines += buf.toString().match(/\\n/g).length;\n});\n\ns.on(\"end\", () => {\n  // Display the number of lines\n  console.log(lines);\n});\n```\n\nAnd that's it, let's test it out.\n\n```sh\n$ node line-count.js -f package.json\n21\n```\n\nUp until now, we've been running our program this way, but if we tried running it by calling it directly we would get an error.\n\n```\n$ line-count count -f package.json\nzsh: command not found: line-count\n```\n\nWe can fix that by registering the binary (that we defined earlier as `bin` in the `package.json`) globally using the `npm link` command.\n\nIn your application's directory, run the following:  \n`npm link`\n\nHurray ! You can now run your script locally like so:  \n`yargs-example count -f package.json`\n\n<br><br>\n\n## <a name=\"deploy\"></a> Deploying our CLI to NPM\n\nBefore deploying it, we'll need to add some information to our `package.json`.\n\n```json\n\"homepage\": \"YOUR GITHUB REPO OR SITE HERE\",\n\"repository\": {\n  \"type\": \"git\",\n  \"url\": \"git+YOUR GITHUB REPOSITORY HERE\"\n},\n\"engines\": {\n  \"node\": \">=8\"\n},\n```\n\nDon't forget to replace the `homepage` and `repository` info with your own, this will allow the npmjs.com website to fill up your future project's page.\n\nThe `engine` value simply defines the minimum version of node your project should work on. Set it to whatever your project requires (depending on what JS features you may end up using, such as `async/await`).\n\nHere are the next steps:\n\n- Create an account on npmjs.com\n- Run the `npm login` command and input your information\n- Run the `npm publish` command which will automatically publish it in a matter of minutes\n\nThat's it ! If you wish to update your project in the future you'll need to change its version number in the `package.json` file and then run the publish command again.\n\nYou now have your own NPM package published and accessible to the community, congrats !\n\nIf you have any questions, feel free to ask them on twitter [@christo_kade](https://twitter.com/christo_kade).\n\nThank you for reading :-)\n"},"__N_SSG":true}