{"pageProps":{"frontmatter":{"title":"Deploying an API to Heroku","description":"It's free and easy to set up.","date":"2017-12-28","slug":"/posts/heroku-api","isPublished":true},"content":"\nAnyone that has met me knows that I love theme parks, that's why I recently deployed [Parks](https://christopherkade.com/parks/), a platform to retrieve wait times at most Disneyland Park around the world.\n\nTo do so I implemented an unofficial API called [themeparks](https://github.com/cubehouse/themeparks) by setting up endpoints on an Node server deployed to the free platform [Heroku](https://www.heroku.com/).\n\nIn this post I'll go through the steps necessary to have your own API up and running on that same platform; let's get started !\n\n### Step 1: Setting up your API\n\n#### Node\n\nFirst, create your project's repository and initialize it:\n\n```bash\nmkdir my-awesome-api\ncd my-awesome-api\nnpm init\n```\n\nWhich will prompt you with some basic npm configuration questions, you can go through them by pressing enter, once asked `entry point: (index.js)`, input `server.js`. That simply defines the entry point to our node program.  \nThis process will create a `package.json` file, it holds metadata relevant to the project.\n\n#### Heroku\n\nLet's make sure you are logged in to Heroku's CLI, if you don't have it installed, you can do it [here](https://devcenter.heroku.com/articles/heroku-cli). Once installed run `heroku login`, which will prompt you for Heroku account information.\n\nOnce logged in, we can set up our project on Heroku by running `heroku create`, which will display:\n\n```bash\nCreating app... done, â¬¢ ancient-garden-55847\nhttps://ancient-garden-55847.herokuapp.com/ | https://git.heroku.com/ancient-garden-55847.git\n```\n\nHeroku sets up your application with a random (and rather soothing) name. Check out your Heroku dashboard, your project should be present.\n\nWe're all set up and ready to create some endpoints !\n\n### Step 2: The first endpoint\n\nLet's start by installing the necessary packages like so:  \n`npm install express body-parser`\n\nCreate a `server.js` file with the following contents:\n\n```javascript\nconst express = require(\"express\"),\n  bodyParser = require(\"body-parser\"),\n  app = express(),\n  port = process.env.PORT || 3000;\n\napp.use(bodyParser.json());\n\napp.get(\"/\", (req, res) => {\n  res.send(\"Server works !\");\n});\n\napp.listen(port);\nconsole.log(\"Server listening on port: \" + port);\n```\n\nAnd navigate to `localhost:3000` on your browser, you should see the following: `Server works !`.\n\n### Another example\n\nThat should be enough for you to get started on declaring your own endpoints, but I'll show a more elaborate example using the Themeparks API mentioned before.\n\nFirst, I'll install the necessary package:  \n`npm install themeparks`\n\nThen, I'll load the Themeparks module, set up options for my header and define a basic endpoint to retrieve every theme park the API handles (in the same `server.js` file):\n\n```javascript\nconst Themeparks = require(\"themeparks\");\n\napp.use(function (req, res, next) {\n  res.setHeader(\"Access-Control-Allow-Origin\", \"http://localhost:4200\");\n  res.setHeader(\"Access-Control-Allow-Methods\", \"GET, POST, OPTIONS, PUT\");\n  res.setHeader(\n    \"Access-Control-Allow-Headers\",\n    \"X-Requested-With,content-type\"\n  );\n  res.setHeader(\"Access-Control-Allow-Credentials\", true);\n  next();\n});\n\napp.get(\"/api/parks\", (req, res) => {\n  let parks = [];\n  for (var park in Themeparks.Parks) {\n    console.log(\"* \" + new Themeparks.Parks[park]().Name + \" (\" + park + \")\");\n    parks.push(new Themeparks.Parks[park]().Name);\n  }\n  res.status(200).json(parks);\n});\n```\n\nI should now be able to target the `/api/parks` endpoint and have a list of parks displayed on my server's console.  \nTo test it locally I can run my server and navigate to `localhost:3000/api/parks` which displays a **long** list of theme parks.\n\nAn application to this endpoint could be to return an array of Park objects to my client in order to inform the user of the supported parks.\n\n### Deploying it to Heroku\n\nDeploying to Heroku is extremely easy:\n\n```bash\n# Start by initializing your repository\ngit init\n# Create a .gitignore file and ignore the node_modules folder\necho \"/node_modules\" > .gitignore\n# Add and commit all of the other files\ngit add .\ngit commit -m \"Initial commit\"\n# Set up the remote to push to as the one created by Heroku\n# Replace ancient-garden-55847 by the name of your Heroku project\nheroku git:remote -a ancient-garden-55847\n# Push everything\ngit push heroku master\n```\n\nOnce pushed, Heroku will deploy your server in a matter of seconds, head to the Heroku dashboard and make sure your build has succeeded in the `Latest activity` panel.\n\nYou can now navigate to your API's URL (or click on Open app) and test it out in any browser !\n\nIn my case [https://ancient-garden-55847.herokuapp.com/api/parks](https://ancient-garden-55847.herokuapp.com/api/parks) returns a list of parks !\n\nPlease note that Heroku's free version has your server sleep when not used for a certain period of time, so if it's the first time you're launching it it will probably take more time than usual.\n\n### Wrapping it up\n\nWe covered how to set up a very basic Node API from scratch and how to deploy it on the great platform that is Heroku. From here, you can build anything you want using the vast documentation that can be found anywhere on the web.\n\nI hope that this post was helpful to some of you,\n\nHappy coding,  \n[@christo_kade](https://twitter.com/christo_kade)\n"},"__N_SSG":true}